<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UMN Twitter Widget</title>
    <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
   
    <link rel="stylesheet" href="styles/stylesW.css">
</head>
<body>

          <div id='viewTweets'>
          </div>


          <script type="text/javascript">
            //to load widget, type "npm start" in terminal, the navigate to http://localhost:5000/

            //!!need to pull out url into variable to be easily swapped out
            //need unique identifier to link to individual book
                let url= 'http://localhost:3000/#/books/'
                // const title = document.getElementsByTagName("TITLE")[0];
                const title= document.title.replace(' â€” University of Minnesota Press','').split(':')[0]
                console.log('this is the book title', title);
                
                  //get tweet ids from database
                        fetch('/api/tweets2/'+ title, //using /:publication_id
                        { method: 'GET',
                          mode: 'no-cors',
                                          }
                        ).then( response => response.json() //turn promise response into JSON data
                        
                        ).then(data=> {
                            console.log('tweet ids:',data);
                            
                            //use response tweetID data to get embeded tweet data
                            for(let i=0;i<data.length;i++){
                              console.log('tweet id', data[i].tweet_id);

                              
                                fetch('/api/tweets2/:title/' + data[i].tweet_id,   //using /:publication_id/:tweet_id
                                { method: 'GET',
                                mode: 'no-cors',
                                                }

                                ).then(response=> response.text() //turn promise response data into html text
                                
                                ).then(html => {console.log('this is the tweet embed html', html)
                                                
                                  let tweetContainer = document.getElementById('viewTweets');//select element to embed tweets
                                  console.log(tweetContainer);

                                  let tweetDiv = document.createElement('div'); //create element for each tweet
                                  console.log(html);

                                  tweetDiv.innerHTML = html;  //insert html data into tweet element
                                
                                  tweetContainer.append(tweetDiv); //append tweet html to the DOM
                                  twttr.widgets.load(document.getElementById("viewTweets"));  //use twttr function to check and load twitter widget elements
                          })
                        }}

                        ).catch((error) => {console.error('Error fetching embed html', error);}

                  ).catch( error => console.error('Error fetching tweet ID', error) )
                
              </script>


  </body>
</html>